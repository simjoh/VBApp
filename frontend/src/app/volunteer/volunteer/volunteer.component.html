<div class="volunteer-container">
  <!-- Header Section -->
  <div class="volunteer-header">
    <div class="header-content">
      <div class="header-icon">
        <i class="pi pi-users"></i>
      </div>
      <div class="header-text">
        <h1>{{ 'volunteer.title' | translate }}</h1>
        <p>{{ 'volunteer.description' | translate }}</p>
      </div>
      <button (click)="op.toggle($event)" pButton pRipple type="button" icon="pi pi-info-circle"
              class="help-button"
              [pTooltip]="'volunteer.helpTooltip' | translate" tooltipPosition="left"></button>
    </div>
  </div>

  <!-- Help Overlay -->
  <p-overlayPanel #op>
    <ng-template pTemplate>
      <div class="p-3" style="max-width: 400px;">
        <h4 class="mb-3">{{ 'volunteer.howItWorks' | translate }}</h4>
        <div class="mb-3">
          <p class="text-600 mb-2">{{ 'volunteer.toSeeParticipants' | translate }}</p>
          <ol class="text-600">
            <li>{{ 'volunteer.step1' | translate }}</li>
            <li>{{ 'volunteer.step2' | translate }}</li>
            <li>{{ 'volunteer.step3' | translate }}</li>
          </ol>
        </div>
        <div class="mb-3">
          <p class="text-600 mb-2">{{ 'volunteer.asVolunteer' | translate }}</p>
          <ul class="text-600">
            <li><i class="pi pi-check-circle text-green-500 mr-2"></i>{{ 'volunteer.checkInParticipants' | translate }}</li>
            <li><i class="pi pi-times-circle text-red-500 mr-2"></i>{{ 'volunteer.markDNF' | translate }}</li>
            <li><i class="pi pi-undo text-blue-500 mr-2"></i>{{ 'volunteer.undoActions' | translate }}</li>
          </ul>
        </div>
      </div>
    </ng-template>
  </p-overlayPanel>

  <!-- Selection Bar -->
  <div class="selection-card">
    <div class="selection-content">
      <!-- Event & Track Selection -->
      <div class="selection-group">
        <div class="selection-icon">
          <i class="pi pi-calendar"></i>
        </div>
        <div class="selection-label">{{ 'volunteer.event' | translate }}</div>
        <div class="selection-input">
          <brevet-tracks-for-event-selector
            [styleClass]="'w-full modern-selector'"
            (trackChange)="trackSelected($event)">
          </brevet-tracks-for-event-selector>
        </div>
      </div>

      <!-- Checkpoint Selection -->
      <div class="selection-group">
        <div class="selection-icon">
          <i class="pi pi-map-marker"></i>
        </div>
        <div class="selection-label">{{ 'volunteer.checkpoint' | translate }}</div>
        <div class="selection-input">
          <brevet-checkpoint-selector></brevet-checkpoint-selector>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Section -->
  <div class="stats-card" *ngIf="(participantStats$ | async) as stats">
    <div class="stats-container">
      <!-- Started Stats -->
      <div class="stat-item started">
        <div class="stat-icon">
          <i class="pi pi-play-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.started || 0 }}</div>
          <div class="stat-label">{{ 'volunteer.started' | translate }}</div>
          <div class="stat-percentage">
            {{ getTotalParticipants(stats) > 0 ? (getTotalStartedParticipants(stats) / getTotalParticipants(stats) * 100).toFixed(1) : '0' }}% {{ 'volunteer.totalParticipants' | translate }}
          </div>
        </div>
      </div>

      <!-- Checked In Stats -->
      <div class="stat-item checked-in">
        <div class="stat-icon">
          <i class="pi pi-check-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.countpassed || 0 }}</div>
          <div class="stat-label">{{ 'volunteer.checkedIn' | translate }}</div>
          <div class="stat-percentage">
            {{ getStartedParticipants(stats) > 0 ? ((stats.countpassed || 0) / getStartedParticipants(stats) * 100).toFixed(1) : '0' }}% {{ 'volunteer.remaining' | translate }}
          </div>
        </div>
      </div>

      <!-- DNF Stats -->
      <div class="stat-item dnf">
        <div class="stat-icon">
          <i class="pi pi-times-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.dnf || 0 }}</div>
          <div class="stat-label">{{ 'volunteer.dnf' | translate }}</div>
          <div class="stat-percentage">
            {{ getTotalParticipants(stats) > 0 ? ((stats.dnf || 0) / getTotalParticipants(stats) * 100).toFixed(1) : '0' }}% {{ 'volunteer.totalParticipants' | translate }}
          </div>
        </div>
      </div>

      <!-- Checked Out Stats -->
      <div class="stat-item checked-out">
        <div class="stat-icon">
          <i class="pi pi-sign-out"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.checkedout || 0 }}</div>
          <div class="stat-label">{{ 'volunteer.checkedOut' | translate }}</div>
          <div class="stat-percentage">
            {{ getStartedParticipants(stats) > 0 ? ((stats.checkedout || 0) / getStartedParticipants(stats) * 100).toFixed(1) : '0' }}% {{ 'volunteer.remaining' | translate }}
          </div>
        </div>
      </div>

      <!-- At Checkpoint Stats -->
      <div class="stat-item at-checkpoint">
        <div class="stat-icon">
          <i class="pi pi-map-marker"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ (stats.countpassed || 0) - (stats.checkedout || 0) }}</div>
          <div class="stat-label">{{ 'volunteer.atCheckpoint' | translate }}</div>
          <div class="stat-percentage">
            {{ getStartedParticipants(stats) > 0 ? (((stats.countpassed || 0) - (stats.checkedout || 0)) / getStartedParticipants(stats) * 100).toFixed(1) : '0' }}% {{ 'volunteer.remaining' | translate }}
          </div>
        </div>
      </div>

      <!-- Expected to Come Stats -->
      <div class="stat-item expected">
        <div class="stat-icon">
          <i class="pi pi-clock"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.expected || 0 }}</div>
          <div class="stat-label">{{ 'volunteer.expected' | translate }}</div>
          <div class="stat-percentage">
            {{ getExpectedPercentage(stats) }}% {{ 'volunteer.expectedPercentage' | translate }} {{ getExpectedPercentageText() }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Participant List -->
  <div class="participant-card">
    <div class="card-header">
      <div class="header-icon">
        <i class="pi pi-list"></i>
      </div>
      <div class="header-text">
        <h3>{{ 'volunteer.participants' | translate }}</h3>
        <p>{{ 'volunteer.manageParticipants' | translate }}</p>
      </div>
    </div>
    <div class="card-content">
      <brevet-participant-list></brevet-participant-list>
    </div>
  </div>
</div>
