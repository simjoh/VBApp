<div class="admin-dashboard">
  <!-- Page Header -->
  <div class="page-header">
    <div class="page-header-content">
      <div class="header-icon">
        <i class="pi pi-user-edit"></i>
      </div>
      <div class="header-text">
        <h1>{{ 'userAdmin.title' | translate }}</h1>
        <p>{{ 'userAdmin.description' | translate }}</p>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="admin-main">
    <div class="admin-content">
      <div class="admin-card">
        <div class="card-content">
          <ng-container *ngIf="users$ | async as users">
            <p-table
              #dt
              [value]="users"
              dataKey="user_uid"
              [tableStyle]="{'min-width': '60rem', 'width': '100%'}"
              styleClass="p-datatable-sm"
              [rowHover]="true"
              [scrollable]="true"
              scrollHeight="flex"
              [sortField]="'name'"
              [sortOrder]="1"
              [globalFilterFields]="['name', 'email', 'permissions']">
              <ng-template pTemplate="caption">
                <div class="flex justify-content-between align-items-center px-3">
                  <span class="p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <input
                      pInputText
                      #filter
                      (input)="dt.filterGlobal($event.target.value, 'contains')"
                      [placeholder]="'userAdmin.searchUsers' | translate"
                      class="p-inputtext-sm"/>
                  </span>
                  <div class="flex align-items-center gap-2">
                    <button
                      pButton
                      pRipple
                      [label]="'userAdmin.newUser' | translate"
                      icon="pi pi-plus"
                      class="p-button-success p-button-sm"
                      (click)="openNew()">
                    </button>
                    <button
                      pButton
                      pRipple
                      icon="pi pi-refresh"
                      class="p-button-text p-button-rounded p-button-sm"
                      (click)="dt.reset()"
                      [pTooltip]="'userAdmin.refresh' | translate"
                      tooltipPosition="top">
                    </button>
                  </div>
                </div>
              </ng-template>
              <ng-template pTemplate="header">
                <tr>
                  <th pSortableColumn="name">
                    {{ 'userAdmin.name' | translate }}
                    <p-sortIcon field="name"></p-sortIcon>
                  </th>
                  <th pSortableColumn="email">
                    {{ 'userAdmin.email' | translate }}
                    <p-sortIcon field="email"></p-sortIcon>
                  </th>
                  <th pSortableColumn="permissions">
                    {{ 'userAdmin.permissions' | translate }}
                    <p-sortIcon field="permissions"></p-sortIcon>
                  </th>
                  <th pSortableColumn="active">
                    {{ 'userAdmin.status' | translate }}
                    <p-sortIcon field="active"></p-sortIcon>
                  </th>
                  <th style="width: 5rem">{{ 'userAdmin.actions' | translate }}</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-user>
                <tr>
                  <td>
                    <div class="flex align-items-center gap-2">
                      <i class="pi pi-user text-primary"></i>
                      <span>{{user.name}}</span>
                    </div>
                  </td>
                  <td>
                    <div class="flex align-items-center gap-2">
                      <i class="pi pi-envelope text-primary"></i>
                      <span>{{user.email}}</span>
                    </div>
                  </td>
                  <td>
                    <div class="flex align-items-center gap-2">
                      <i class="pi pi-shield text-primary"></i>
                      <span>{{user.permissions}}</span>
                    </div>
                  </td>
                  <td>
                    <span [class]="'status-tag ' + (user.active ? 'status-active' : 'status-inactive')">
                      {{user.active ? ('userAdmin.active' | translate) : ('userAdmin.inactive' | translate)}}
                    </span>
                  </td>
                  <td>
                    <div class="flex justify-content-center gap-2">
                      <button
                        pButton
                        pRipple
                        icon="pi pi-pencil"
                        class="p-button-rounded p-button-primary p-button-text p-button-sm"
                        (click)="editUser(user)"
                        [pTooltip]="'userAdmin.edit' | translate"
                        tooltipPosition="top">
                      </button>
                      <button
                        pButton
                        pRipple
                        icon="pi pi-trash"
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        [disabled]="!canDelete(user)"
                        (click)="deleteUser(user.user_uid)"
                        [pTooltip]="'userAdmin.delete' | translate"
                        tooltipPosition="top">
                      </button>
                    </div>
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="5">
                    <div class="flex flex-column align-items-center gap-3 py-5">
                      <i class="pi pi-user text-primary" style="font-size: 2rem"></i>
                      <span class="text-900 font-medium text-xl">{{ 'userAdmin.noUsersFound' | translate }}</span>
                      <span class="text-700">{{ 'userAdmin.noUsersToShow' | translate }}</span>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
            <p-confirmDialog [style]="{width: '450px'}" [baseZIndex]="10000"></p-confirmDialog>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>

<p-toast></p-toast>

<style>
.status-tag {
  display: inline-block;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.875rem;
  font-weight: 500;
}

.status-active {
  background-color: #E7F7E7;
  color: #1B801B;
}

.status-inactive {
  background-color: #FEE2E2;
  color: #DC2626;
}
</style>

