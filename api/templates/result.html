
<!DOCTYPE html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Consume XML request</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script type="text/javascript">
        function ajaxFunction(callback) {
            var ajaxRequest;  // The variable that makes Ajax possible!
            try {
                // Opera 8.0+, Firefox, Safari
                ajaxRequest = new XMLHttpRequest();

            } catch (e) {

                // Internet Explorer Browsers
                try {
                    ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
                } catch (e) {

                    try {
                        ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
                    } catch (e) {
                        // Something went wrong
                        alert("Your browser broke!");
                        return false;
                    }
                }
            }
            ajaxRequest.onreadystatechange = function() {
                if(ajaxRequest.readyState === 4) {
                    var ajaxDisplay = document.getElementById('ajaxDiv');
                    // ajaxDisplay.innerHTML = JSON.parse(ajaxRequest.responseText)[0].name;
                    createTableCallBack(JSON.parse(ajaxRequest.responseText));
                }
            }

            ajaxRequest.open("GET", `{{link}}`);
            ajaxRequest.setRequestHeader("API_KEY", "notsecret_developer_key");
            ajaxRequest.send(null);
        }


        function createTableCallBack(data){
            let table = document.querySelector("table");
            generateTableHead(table, Object.keys(data[0]));
            generateTable(table, data);
		}

        function generateTable(table, data) {
            for (let element of data) {
                let row = table.insertRow();
                row.classList.add("done");
                for (key in element) {
                    let cell = row.insertCell();
                    let text = document.createTextNode(element[key]);
                    cell.appendChild(text);
                }
            }
        }

        function generateTableHead(table, data) {
            let thead = table.createTHead();
            let row = thead.insertRow();
            for (let key of data) {
                let th = document.createElement("th");
                let text = document.createTextNode(key);
                th.appendChild(text);
                row.appendChild(th);
            }
        }

        ajaxFunction(createTableCallBack)
	</script>

	<style>

        body {
            font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
            text-align: left;
        }

        table {
            border-collapse: collapse;
        }

        th, td {
            border-bottom: 1px solid black;
            padding: .6em;
        }

        th {
            background: black;
            color: white;
        }

        td:nth-child(1) {
            text-align: right;
        }

        td:nth-child(2) {
            text-align: right;
        }

        .dnf {
            background: #bbbbbb;
            color: #444444;
        }

        .done {
            background: #f8b62a;
            font-weight: bold;
        }

        .center {
            margin: auto;
            width: 50%;
            padding: 10px;
        }

	</style>
</head>



<table class="center">
</table>
<!--<div id="ajaxDiv"></div>-->


