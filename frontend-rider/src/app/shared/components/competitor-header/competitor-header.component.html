<div class="header-container">
  <header class="competitor-header">
    <div class="header-left">
      <app-logo [height]="40" [width]="40" [rolling]="false"></app-logo>
    </div>

    <div class="header-center">
      <div class="rider-info">
        <span class="start-number">{{ startNumber }}</span>
        <span class="rider-name">{{ riderName }}</span>
      </div>
    </div>

    <div class="header-right">
      <button
        class="logout-button"
        (click)="onLogout()"
      >
        <i class="pi pi-sign-out"></i>
        <span>Logout</span>
      </button>
    </div>
  </header>

  <div class="toolbar">
    <div class="toolbar-left">
      <div class="location-status"
           (click)="toggleLocationPopover($event)"
           (touchstart)="toggleLocationPopover($event)"
           #locationTrigger>
        <i class="pi pi-globe status-icon"
           [class]="'status-' + locationStatus + (isUpdating() ? ' updating' : '') + (isLocationFresh ? ' fresh' : '')"></i>
        <span class="status-text">{{ 'geolocation.status' | translate }}</span>
      </div>

      <p-popover #locationPopover>
        <ng-template pTemplate="content">
          <div class="location-popover">
            <div class="popover-header">
              <i class="pi pi-globe"></i>
              <span>{{ 'geolocation.statusTitle' | translate }}</span>
            </div>
            <div class="popover-content">
              <div class="status-item">
                <span class="status-label">{{ 'geolocation.status' | translate }}:</span>
                <span class="status-value" [class]="'status-' + locationStatus">
                  {{ getLocationStatusLabel() }}
                </span>
              </div>
              @if (currentCoordinates && locationStatus === 'granted') {
                <div class="status-item">
                  <span class="status-label">{{ 'geolocation.coordinates' | translate }}:</span>
                  <span class="status-value coordinates">
                    {{ currentCoordinates.latitude.toFixed(6) }}, {{ currentCoordinates.longitude.toFixed(6) }}
                  </span>
                </div>
                <div class="status-item">
                  <span class="status-label">{{ 'geolocation.freshness' | translate }}:</span>
                  <span class="status-value" [class]="isLocationFresh ? 'fresh' : 'stale'">
                    {{ isLocationFresh ? ('ðŸŸ¢ ' + ('geolocation.fresh' | translate)) : ('ðŸŸ¡ ' + ('geolocation.stale' | translate)) }}
                  </span>
                </div>
              }
            </div>
          </div>
        </ng-template>
      </p-popover>
    </div>

    <div class="toolbar-center">
      <!-- Reserved for future toolbar items -->
    </div>

    <div class="toolbar-right">
      <app-flag-language-selector></app-flag-language-selector>
    </div>
  </div>

  <!-- Progress bar -->
  @if (cyclingProgress && cyclingProgress.totalDistance > 0) {
    <div class="progress-bar-container">
      <div class="progress-bar"
           [style.width.%]="cyclingProgress.progressPercentage">
      </div>
      <div class="progress-text">
        <span class="progress-distance">
          {{ cyclingProgress.currentDistance.toFixed(1) }} km / {{ cyclingProgress.totalDistance.toFixed(1) }} km
        </span>
        <span class="progress-percentage">
          {{ cyclingProgress.progressPercentage.toFixed(1) }}%
        </span>
      </div>
    </div>
  }
</div>
