<div class="checkpoint-button-container">
  <!-- Timer and Progress Bar (only shown when checked in) -->
  @if (showTimer) {
    <div class="timer-section">
      <div class="timer-display" [class.over-time]="isOverTime">
        <i class="pi pi-clock"></i>
        <span>{{ timerDisplay }}</span>
        @if (isOverTime) {
          <span class="over-time-warning">(Over Time!)</span>
        }
      </div>
      <div class="progress-bar">
        <div
          class="progress-fill"
          [class.over-time]="isOverTime"
          [style.width.%]="progressPercentage">
        </div>
      </div>
    </div>
  }

  <!-- Single button that changes function and text based on state -->
  <button
    [class]="buttonClass"
    [disabled]="isButtonDisabled"
    (click)="onButtonClick()"
  >
    @if (loading) {
      <i class="pi pi-spin pi-spinner button-icon"></i>
    } @else {
      <i [class]="buttonIcon + ' button-icon'"></i>
    }
    <span class="button-text">{{ buttonText }}</span>
  </button>

  <!-- Remove redundant timestamp info since checkpoint card already shows "Time:" -->

  <!-- Status indicator for completed states -->
  @if (checkpoint.isFirst && checkpoint.status === 'checked-in') {
    <div class="status-indicator started">
      <i class="pi pi-check-circle"></i>
      <span>Brevet Started</span>
    </div>
  }

  @if (checkpoint.isLast && checkpoint.status === 'checked-in') {
    <div class="status-indicator finished">
      <i class="pi pi-flag"></i>
      <span>Brevet Completed!</span>
    </div>
  }
</div>
